<div class="loyall-box-product">
  <!-- NO AUTH -->
  <div class="title">
    Opptjen
    <span class="title__bonus-amount-product">
      <span class="title">opp til</span>
      {{
        product.selected_or_first_available_variant.price
          | times: 0.0015
          | times: 100
          | money
      }}
    </span>
    i bonus*
  </div>
  <small class="disclaimer"
    >*Bonus amount may change, if you pay with bonus.</small
  >
  <div class="description">
    <div>Gjennomfør kjøpet nå og tjen bonus på denne varen.</div>
    <div>
      Bonusmedlemmer får <span class="bonus-percent-product">opp til 15</span>%
      bonus på ordinære varer.
    </div>
  </div>
  <div class="noAuth-product show">
    <div class="action">
      <button
        class="action__button show disableOnActive tjen-bonus-btn-product"
      >
        Tjen bonus nå!
      </button>
    </div>
    <div id="loyalty-product-modal">
      <div class="modal-content">
        <form class="login-form-product">
          <div class="phone">
            <select id="country-code-product" name="country-code-product">
              <option value="47">🇳🇴 +47</option>
              <option value="46">🇸🇪 +46</option>
            </select>
            <div>
              <label for="phone-number-product">Phone number</label>
              <input
                id="phone-number-product"
                name="phone-number-product"
                pattern="[0-9]{8}"
                placeholder="Ex: 99999999"
                required
                type="tel"
              />
            </div>
          </div>
          <input class="action__button" type="submit" value="Submit" />
        </form>
      </div>
    </div>
    <div class="verification-wrapper-product">
      <div class="verification">
        <form class="verification-form-product">
          <label for="code"
            >Enter the verification code that you received on your phone
            <span id="phone"></span>
          </label>
          <div style="margin: 10px auto">
            <input
              id="code-product"
              maxlength="6"
              name="code"
              pattern="[a-zA-Z0-9]{6}"
              placeholder="ABCDEF"
              required
              type="text"
            />
          </div>
          <input
            class="verify-code-btn-product disableOnActive action__button_white"
            type="submit"
            value="Verify code"
          />
        </form>
        <p id="verify-result-product"></p>
        <button class="action__button again-code-btn-product disableOnActive">
          Receive code again
        </button>
      </div>
    </div>
  </div>
  <div class="spinner-product">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      style="
        margin: auto;
        background: none;
        display: block;
        shape-rendering: auto;
      "
      width="50"
      height="50"
      viewBox="0 0 100 100"
      preserveAspectRatio="xMidYMid"
    >
      <path
        d="M9 50A41 41 0 0 0 91 50A41 43.8 0 0 1 9 50"
        fill="#1d0e0b"
        stroke="none"
      >
        <animateTransform
          attributeName="transform"
          type="rotate"
          dur="1s"
          repeatCount="indefinite"
          keyTimes="0;1"
          values="0 50 51.4;360 50 51.4"
        ></animateTransform>
      </path>
      <!-- [ldio] generated by https://loading.io/ -->
    </svg>
  </div>
  <!-- AUTHENTICATED MEMBER-->
  <div class="auth-product">
    <span>Go to your cart for applying bonus on this purchase.</span>
    <a
      href="/cart"
      class="action__button"
      style="display: block; margin-top: 10px"
    >
      Go to cart to use bonus
    </a>
  </div>
  <!-- AUTHENTICATED NOT MEMBER-->
  <div class="auth-product-not-member">
    <span
      >To receive your bonus, make sure to register for a loyalty account after
      the purchase.</span
    >
  </div>
</div>

<script>
  const intervalIdProduct = setInterval(() => {
    // Initial checks on page load
    if (loyalty?.shop?.data) {
      loyalty.product.data = {{ product.selected_or_first_available_variant | json }};
      loyalty.initProductPage();

      clearInterval(intervalIdProduct);
    }
  }, 200);

  // add tjen bonus event listener
  const tjenBonusBtnProduct = document.querySelector('.tjen-bonus-btn-product');
  tjenBonusBtnProduct.addEventListener('click', event => {
    loyalty.tjenBonus(event, 'product');
  })

  // submit login form event listener
  const productFormEl = document.querySelector('.login-form-product');
  productFormEl.addEventListener('submit', (event) => {
    event.preventDefault();
    loyalty.submitLoginForm(event, 'product');
  })

  // add code verification event listener
  const verifyFormEl = document.querySelector('.verification-form-product');
  verifyFormEl.addEventListener('submit', (event) => {
    event.preventDefault();
    loyalty.submitVerificationCode(event, 'product');
  });
</script>

<style>
  .loyall-box-product {
    margin: 1rem 0;
    padding: 3rem 1rem;
    width: 100%;
    background: white;
    box-shadow: 0 0 10px 2px rgba(51, 51, 51, 0.06);
    /* border-radius: 10px; */
    text-align: center;
  }

  .verification-wrapper-product,
  .tjen-bonus-btn-product,
  .login-form-product,
  .spinner-product,
  .noAuth-product,
  .auth-product-not-member,
  .auth-product {
    display: none;
  }

  .loyall-box-product .show,
  .spinner-product.show {
    display: block;
  }

  .loyall-box-product .title {
    font-size: 1.3rem;
    text-transform: uppercase;
    color: #a78f62;
  }

  .loyall-box-product .title__bonus-amount-product {
    text-transform: none;
    color: black;
  }

  .loyall-box-product .description {
    font-size: 0.875rem;
    padding: 1rem 0;
  }

  .loyall-box-product .action__button {
    font-size: 0.9rem;
    text-transform: uppercase;
    padding: 1rem;
    background: black;
    color: white;
    border: none;
    transition: all 0.2s ease-in-out;
    margin: auto;
  }

  .loyall-box-product .action__button_white {
    font-size: 0.9rem;
    text-transform: uppercase;
    padding: 1rem;
    background: white;
    color: black;
    border: 1px solid lightgrey;
    border-radius: 5px;
    transition: all 0.2s ease-in-out;
    margin: auto;
  }

  .loyall-box-product .action__button:hover {
    opacity: 0.7;
  }
  .disableOnActive:disabled {
    background-color: grey;
  }
  .disableOnActive:disabled:hover {
    opacity: 1;
    background-color: grey;
    cursor: not-allowed;
  }

  .loyall-box-product .verification {
    padding: 20px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .loyall-box-product .verification-form-product {
    padding: 20px 10px;
  }

  .loyall-box-product input {
    text-align: center;
  }

  .loyall-box-product #code-product {
    text-transform: uppercase;
  }

  /* loyalty product modal */

  #loyalty-product-modal form {
    padding: 20px;
    background-color: white;
    position: relative;
  }

  #loyalty-product-modal .phone {
    display: flex;
    justify-content: flex-start;
    align-items: flex-end;
  }

  #loyalty-product-modal input {
    margin-bottom: 10px;
  }

  #loyalty-product-modal label {
    text-align: left;
  }

  #loyalty-product-modal select {
    margin: 0 10px 10px 0;
  }

  #loyalty-product-modal input:invalid {
    border: 2px solid red;
  }

  #loyalty-product-modal .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
  }
</style>
