<div class="loyall-box-cart">
  <!-- NO AUTH -->
  <div class="title">
    Opptjen
    <span class="title__bonus-amount-cart">
      <span class="title">opp til</span>
      {{
        product.selected_or_first_available_variant.price
          | times: 0.0015
          | times: 100
          | money
      }}
    </span>
    i bonus*
  </div>
  <small class="disclaimer"
    >*Bonus amount may change, if you pay with bonus.</small
  >
  <div class="description">
    <div>Gjennomfør kjøpet nå og tjen bonus på denne varen.</div>
    <div>
      Bonusmedlemmer får <span class="bonus-percent-cart">opp til 15</span>%
      bonus på ordinære varer.
    </div>
  </div>
  <div class="noAuth-cart show">
    <div class="action">
      <button class="action__button show disableOnActive tjen-bonus-btn-cart">
        Tjen bonus nå!
      </button>
    </div>
    <div id="loyalty-cart-modal">
      <div class="modal-content">
        <form class="login-form-cart">
          <div class="phone">
            <select id="country-code-cart" name="country-code-cart">
              <option value="47">🇳🇴 +47</option>
              <option value="46">🇸🇪 +46</option>
            </select>
            <div>
              <label for="phone-number-cart">Phone number</label>
              <input
                id="phone-number-cart"
                name="phone-number-cart"
                pattern="[0-9]{8}"
                placeholder="Ex: 99999999"
                required
                type="tel"
              />
            </div>
          </div>
          <input class="action__button" type="submit" value="Submit" />
        </form>
      </div>
    </div>
    <div class="verification-wrapper-cart">
      <div class="verification">
        <form class="verification-form-cart">
          <label for="code"
            >Enter the verification code that you received on your phone
            <span id="phone"></span>
          </label>
          <div style="margin: 10px auto">
            <input
              id="code-cart"
              maxlength="6"
              name="code"
              pattern="[a-zA-Z0-9]{6}"
              placeholder="ABCDEF"
              required
              type="text"
            />
          </div>
          <input
            class="verify-code-btn-cart disableOnActive action__button_white"
            type="submit"
            value="Verify code"
          />
        </form>
        <p id="verify-result-cart"></p>
        <button class="action__button again-code-btn-cart disableOnActive">
          Receive code again
        </button>
      </div>
    </div>
  </div>
  <div class="spinner-cart show">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      style="
        margin: auto;
        background: none;
        display: block;
        shape-rendering: auto;
      "
      width="50"
      height="50"
      viewBox="0 0 100 100"
      preserveAspectRatio="xMidYMid"
    >
      <path
        d="M9 50A41 41 0 0 0 91 50A41 43.8 0 0 1 9 50"
        fill="#1d0e0b"
        stroke="none"
      >
        <animateTransform
          attributeName="transform"
          type="rotate"
          dur="1s"
          repeatCount="indefinite"
          keyTimes="0;1"
          values="0 50 51.4;360 50 51.4"
        ></animateTransform>
      </path>
      <!-- [ldio] generated by https://loading.io/ -->
    </svg>
  </div>
  <!-- AUTHENTICATED MEMBER -->
  <div class="auth-cart" id="apply-bonus-form">
    <form onsubmit="return false;">
      <div style="font-size: 1.3em">
        Available bonus:
        <span class="text-bold available-loyalty-bonus"></span>
      </div>
      <div>
        <label class="apply-bonus-form-label show" for="appliedBonus"
          >How much bonus would you like to use?</label
        >
        <br />
        <input
          class="apply-bonus-form-input show"
          id="appliedBonus"
          min="0"
          name="appliedBonus"
          placeholder="Ex: 200 kr"
          required
          type="number"
        />
        <div class="error-message" id="discount-value-error"></div>
      </div>
      <div class="your-discount-code-text">
        <div>The following discount code will be applied at checkout.</div>
        <span>Your discount code is: </span>
        <span class="your-discount-code"></span>
      </div>
      <input
        class="action__button disableOnActive"
        id="apply-bonus-form-submit-btn"
        type="button"
        value="Apply Bonus"
      />
    </form>
  </div>
  <!-- AUTHENTICATED NOT MEMBER-->
  <div class="auth-cart-not-member">
    <span
      >To receive your bonus, make sure to register for a loyalty account after
      the purchase.</span
    >
  </div>
</div>

<script>
  const intervalIdCart = setInterval(() => {
    // Initial checks on page load
    if (loyalty?.shop?.data) {
      loyalty.initCartPage();

      clearInterval(intervalIdCart);
    }
  }, 200);

  // add tjen bonus event listener
  const tjenBonusBtnCart = document.querySelector(".tjen-bonus-btn-cart");
  tjenBonusBtnCart.addEventListener("click", (event) => {
    loyalty.tjenBonus(event, "cart");
  });

  // submit login form event listener
  const cartFormEl = document.querySelector(".login-form-cart");
  cartFormEl.addEventListener("submit", (event) => {
    event.preventDefault();
    loyalty.submitLoginForm(event, "cart");
  });

  // add code verification event listener
  const verifyFormElCart = document.querySelector(".verification-form-cart");
  verifyFormElCart.addEventListener("submit", (event) => {
    event.preventDefault();
    loyalty.submitVerificationCode(event, "cart");
  });

  const discountSubmitBtn = document.querySelector(
    "#apply-bonus-form-submit-btn"
  );
  discountSubmitBtn.addEventListener("click", (e) => {
    loyalty.submitApplyBonusForm(e);
  });
</script>

<style>
  .loyall-box-cart {
    margin: 1rem 0;
    padding: 3rem 1rem;
    width: 100%;
    background: white;
    box-shadow: 0 0 10px 2px rgba(51, 51, 51, 0.06);
    /* border-radius: 10px; */
    text-align: center;
  }

  .your-discount-code-text,
  .apply-bonus-form-input,
  .apply-bonus-form-label,
  .verification-wrapper-cart,
  .tjen-bonus-btn-cart,
  .login-form-cart,
  .spinner-cart,
  .noAuth-cart,
  .auth-cart,
  .auth-cart-not-member {
    display: none;
  }

  .loyall-box-cart .show,
  .spinner-cart.show {
    display: block;
  }

  .apply-bonus-form-input.show,
  .apply-bonus-form-label.show {
    display: inline-block !important;
  }

  .your-discount-code {
    font-weight: bold;
    color: blue;
  }

  #apply-bonus-form {
    padding: 10px 0;
  }

  #apply-bonus-form-submit-btn {
    margin: 10px 0;
  }

  .loyall-box-cart .title {
    font-size: 1.3rem;
    text-transform: uppercase;
    color: #a78f62;
  }

  .loyall-box-cart .title__bonus-amount-cart {
    text-transform: none;
    color: black;
  }

  .loyall-box-cart .description {
    font-size: 0.875rem;
    padding: 1rem 0;
  }

  .loyall-box-cart .action__button {
    font-size: 0.9rem;
    text-transform: uppercase;
    padding: 1rem;
    background: black;
    color: white;
    border: none;
    transition: all 0.2s ease-in-out;
    margin: auto;
  }

  .loyall-box-cart .action__button_white {
    font-size: 0.9rem;
    text-transform: uppercase;
    padding: 1rem;
    background: white;
    color: black;
    border: 1px solid lightgrey;
    border-radius: 5px;
    transition: all 0.2s ease-in-out;
    margin: auto;
  }

  .loyall-box-cart .action__button:hover {
    opacity: 0.7;
  }
  .disableOnActive:disabled {
    background-color: grey;
  }
  .disableOnActive:disabled:hover {
    opacity: 1;
    background-color: grey;
    cursor: not-allowed;
  }

  .loyall-box-cart .verification {
    padding: 20px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .loyall-box-cart .verification-form-cart {
    padding: 20px 10px;
  }

  .loyall-box-cart input {
    text-align: center;
  }

  .loyall-box-cart #code-cart {
    text-transform: uppercase;
  }

  /* loyalty product modal */

  #loyalty-cart-modal form {
    padding: 20px;
    background-color: white;
    position: relative;
  }

  #loyalty-cart-modal .phone {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #loyalty-cart-modal input {
    margin-bottom: 10px;
  }

  #loyalty-cart-modal label {
    text-align: left;
  }

  #loyalty-cart-modal select {
    margin: 0 10px 10px 0;
  }

  #loyalty-cart-modal input:invalid {
    border: 2px solid red;
  }

  #loyalty-cart-modal .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
  }

  .error-message {
    color: red;
  }
</style>
